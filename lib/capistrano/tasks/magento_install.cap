
namespace :magento do

    desc "Install Magento for the first time"
    task :install do
        invoke 'magento:deploy_core'
        invoke 'magento:deploy_modules'
    end

    #Before we install do a deploy
    before 'magento:install', 'deploy'
    after 'magento:install', 'magerun:install_magento'

    desc "Update Magento, used after initial deploy"
    task :update do
        on roles(:all) do |host|
            within release_path do
                magento_version = fetch(:magento_version)
                path = "vendor/jhhello/#{magento_version}"
                execute "cp -R #{path} htdocs"
            end
        end
    end

    desc "Deploy Magento Core"
    task :deploy_core do
        on roles(:all) do |host|
            within release_path do
                execute "php", "vendor/bin/composerCommandIntegrator.php magento-core-deploy"
            end
        end
    end

    desc "Deploy Magento Modules"
    task :deploy_modules do
        on roles(:all) do |host|
            within release_path do
                execute "php", "vendor/bin/composerCommandIntegrator.php magento-module-deploy"
            end
        end
    end

end
